# Incremental モデルパターン

## 目的
Incremental モデルは、新規または更新分のみを処理することでコストを削減し、性能を改善しながら安定した出力を維持します。

## 設計方法
- 変更検知に使う安定した `unique_key` を定義する。
- ウォーターマーク（例: `updated_at` やイベント時刻）を選ぶ。
- 遅延到着データへの対応としてローリングウィンドウを検討する。
- merge/upsert によって冪等性を担保する。

## 具体例
- ソーステーブル `raw_events` に `event_id` と `updated_at` がある。
- 差分条件: `updated_at >= max(updated_at)`。
- 一意キー: `event_id`。

## スケーラビリティの考慮点
- 毎回フルスキャンしないようにする。
- 可能なら時間パーティションを利用する。
- ウォーターマークの遅延や到着遅延の量を監視する。
- 定期的にフルリフレッシュのベンチマークを行う。
